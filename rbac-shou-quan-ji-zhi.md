---
description: 授權機制
---

# RBAC授權機制

## 架構

以Role Based Accecc Control機制延伸設計以下系統授權機制

<figure><img src=".gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

說明

* 多租戶架構，跨租戶間數據不流通，不共享
* 當用戶有跨租戶管理需求，則需切換不同帳號
* 以下以單一租戶說明
* 設定流程：
  * 新增角色
  * 設定角色操作權限
  * 設定角色資料範圍
  * 新增用戶帳號綁定角色



{% tabs %}
{% tab title="User 用戶" %}
* 用戶增加三層用戶組織(分類)>(組織)>>(子組織)樹狀結構
* 第一層組織(分類)：
  * 主管機關(縣市政府)
  * 客運業者
  * 製造商(鴻華)
  * 平台開發商(鴻海)
* 第二層組織(組織)：
  * 主管機關(縣市政府) > 高雄市政府
  * 客運業者 > 三地集團、首都集團、新營客運、員林客運、金牌客運、普悠瑪客運。
  * 製造商 > 鴻華。
  * 平台開發商 > 鴻海。
* 第三層組織(子組織)：
  * 主管機關(縣市政府) > 高雄市政府 >> 各局處
    * 交通局、環保局等。
  * 客運業者：
    * 三地集團 >>高雄客運、府城客運。
    * 首都集團 >>台中客運、三重客運、台北客運、大都會客運。
    * 新營客運 >> 新營客運
    * 員林客運 >> 員林客運
    * 金牌客運 >> 牌客運
    * 普悠瑪客運 >>  普悠瑪客運。
  * 製造商>鴻華 暫無需定義第三層組織，可隨需定義。
  * 平台開發商>鴻海 暫無需定義第三層組織，可隨需定義。
* 組織圖



* 新增用戶帳號時，需設定組織
* 一位用戶只屬於一個組織





* 討論
  * 當用戶組織階層多時，可支援用戶組綁角色。不多時，用戶直接綁角色比較有彈性。
  * 一位用戶可設定多個角色？角色可免登出自由切換？還是限制一位用戶只可設定一個角色？
{% endtab %}

{% tab title="Role 角色" %}
* 角色分為 **共用角色** 與 **特殊角色。**
  * **共用角色**為所有組織共用，**特殊角色**為單一組織使用。
  * **共用角色**為系統預先定義好一些常用的角色，可滿足大部分需求
  * e.g. 如下共用角色表

<table><thead><tr><th width="138">角色名稱</th><th width="84">屬性</th><th>操作權限</th><th width="151">資料範圍</th><th>適合對象</th></tr></thead><tbody><tr><td>超級管理員</td><td>共用</td><td>最大權限 ALL</td><td>ALL</td><td>平台開發商</td></tr><tr><td>組織管理員</td><td>共用</td><td>用戶帳號管理<br>角色權限管理</td><td>ALL</td><td>主管機關、製造商</td></tr><tr><td>客運業者管理員</td><td>共用</td><td>用戶帳號管理<br>角色權限管理</td><td>自己業者的資料</td><td>客運業者</td></tr><tr><td>一般讀取</td><td>共用</td><td>讀取權限</td><td>ALL</td><td>主管機關、製造商</td></tr><tr><td>營運監控</td><td>共用</td><td>營運監控相關報表功能</td><td>自己業者的資料</td><td>客運業者</td></tr><tr><td>...</td><td></td><td></td><td></td><td></td></tr></tbody></table>



* **特殊角色**區分組織，關聯第一層用戶組織 (主管機關、客運業者\*N、製造商、平台開發商)
* 超級管理員(共)可檢視所有角色，及所有操作權限。
* 其餘角色僅能檢視共用角色+組織自行定義的特殊角色。
* 情境說明
  * 目前有3個共用角色：超級管理員(共)、系統維運人員(共)、報表分析人員(共)。
  * 三地集團-高雄客運自行定義2個特殊角色：鳳山站長(特)、楠梓站長(特)。
  * 普悠瑪客運自行定義2個特殊角色：總站長(特)、營運分析人員(特)。
  * 製造商自行定義2個特殊角色：維修人員(特)、駐點客戶人員(特)。
  * 主管機關/平台開發商 進入系統可以看到3個共用角色(僅可查詢)
  * 製造商進入系統可以看到3個共用角色(僅可查詢)+2個自定義特殊角色(所有操作權限)
  * 三地集團-高雄客運進入系統可以看到3個共用角色(僅可查詢)+2個自定義特殊角色(所有操作權限)



* 討論
  * 考量是否下放角色管理功能，是否由超級管理員統一管理角色
  * 暫時不考慮role分層(RBAC1)，若存在user階層關係，直接用不同role賦予權限上的階級差異即可
{% endtab %}

{% tab title="Permissions 操作權限" %}
* 操作權限設定以功能目錄樹狀結構表示
* 每個功能/報表(Resource)下支援操作(Operation)權限設定：
  * 新增(Create)/刪除(Delete)/修改(Update)/查詢(Read)等基本操作權限。
  * 保留可加入客製操作權限之彈性。e.g. 匯出檔案權限
  * 預設全選，基本具備查詢(Read)權限。
* 作用於目錄內功能及按鈕顯示及訪問/操作權限
* 功能/報表開發後需要註冊，及定義該功能或報表支援的操作類型增/刪/改/查/匯出/匯入等。需要實作角色設定的權限控管
  * e.g. 新增「各場站準點率報表」，支援查詢及匯出報表操作，則於權限設定時，Resource「各場站準點率報表」支援兩種操作設定Operation查詢(Read)及匯出(Export)
{% endtab %}

{% tab title="Scopes 資料範圍" %}
* 資料範圍用於設定角色可存取的資料範圍。
* 設定以**客運業者**(組織第三層作為第一階)>**場站**(第二階)樹狀結構表示。
* 依照登入用戶的第一層組織連動可選擇的資料範圍
  * 若組織 in (主管單位、製造商、平台開發商)皆**可存取全部資料 或 設定子集合**。
  * 若第一層組織=客運業者，則限制資料範圍僅能選擇該業者資料
    * 獨立客運業者(第二層組織in(新營客運、員林客運、金牌客運、普悠瑪客運)) **僅可以存取自己的資料，無法更改設定**。
      * e.g. 客運業者>金牌客運，可設定客運業者預設僅有金牌客運。
    * 集團客運業者(第二層組織in(三地集團、首都集團)) **可存取集團內客運業者資料  或 設定子集合。**
      * e.g. 客運業者>三地集團，可設定客運業者預設包含高雄客運、府城客運。
      * e.g. 客運業者>首都集團，可設定客運業者預設包含台中客運、三重客運、台北客運、大都會客運。
* 場站(第二階)與所選擇的客運業者(第一階)連動。
* 套用於部分報表及功能作為資料權限區分
  * e.g. 場站營運報表，若為普悠瑪客運，僅能查看普悠瑪客運底下各場站數據



* 討論
  * 由於目前組織可存取資料範圍較單純，且變動不高，可考量直接以系統config方式來做
  * 考量不同維度設定資料範圍的需求
  * 考慮部分部分報表及功能可能無法套用
{% endtab %}
{% endtabs %}





## 系統功能



<details>

<summary>組織管理</summary>

設定三層組織樹狀圖

Operations: 查詢/新增/刪除/修改 組織功能

僅開放給超級管理員權限

</details>

<details>

<summary>用戶帳號管理</summary>

帳號管理功能，設定帳號角色

Operations: 查詢/新增/刪除/修改 用戶帳號功能

組織：下拉選單

帳號：命名規則

密碼：

密碼確認：

姓名：

email：

角色：下拉選單

狀態：



</details>

<details>

<summary>角色權限管理</summary>

設定角色功能權限

設定角色資料範圍

Operations: 查詢/新增/刪除/修改 角色功能



</details>

<details>

<summary> 功能管理</summary>

功能註冊

功能代碼

支援操作類型

</details>

